<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TimeSlots Booking</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #f9f9f9;
    margin: 0;
    padding: 20px;
  }
  .container {
    max-width: 600px;
    margin: auto;
    background: #fff;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  }
  .header {
    text-align: center;
    color: #ff7f00;
  }
  .timeslot {
    border: 1px solid #ddd;
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 4px;
  }
  .timeslot.available {
    background-color: #e7f4e4;
  }
  .timeslot.booked {
    background-color: #fde8e4;
  }
  .booking-form input,
  .booking-form select,
  .booking-form button {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
  }
  .booking-form button {
    background-color: #ff7f00;
    color: white;
    border: none;
    cursor: pointer;
  }
  .booking-form button:hover {
    background-color: #e66f00;
  }
  .error-message {
    color: red;
    margin-bottom: 10px;
  }
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>TimeSlots Booking</h1>
    <p>Book your appointment slot with ease.</p>
  </div>
  <div id="timeslots"></div>
  <div class="booking-form">
    <h3>Create a Slot</h3>
    <input type="date" id="newSlotDate" placeholder="Date (YYYY-MM-DD)" required>
    <input type="time" id="newSlotTime" placeholder="Time (HH:MM)" required>
    <button onclick="createSlot()">Create Slot</button>
    <h3>Book a Slot</h3>
    <input type="text" id="firstName" placeholder="First Name" required>
    <input type="text" id="lastName" placeholder="Last Name" required>
    <select id="slotSelect">
      <option value="">Select a Time Slot</option>
      <!-- Exemplary hardcoded options -->
      <option value="1">Date: 2023-01-01, Time: 09:00</option>
      <option value="2">Date: 2023-01-01, Time: 10:00</option>
      <option value="3">Date: 2023-01-01, Time: 11:00</option>
      <option value="4">Date: 2023-01-01, Time: 12:00</option>
      <option value="5">Date: 2023-01-01, Time: 13:00</option>
    </select>
    <button onclick="bookSlot()">Book Now</button>
    <h3>Delete a Slot</h3>
    <select id="deleteSlotSelect">
      <option value="">Select a Time Slot to Delete</option>
      <!-- Options will be populated by JavaScript -->
    </select>
    <button onclick="deleteSlot()">Delete Slot</button>
    <div id="errorOutput" class="error-message"></div>
  </div>
</div>

<script>
const apiUrl = 'http://localhost:8000/timeslots/';

function clearError() {
  displayError('');
}

function displayError(message) {
  const errorOutput = document.getElementById('errorOutput');
  errorOutput.textContent = message;
}

function fetchSlots() {
  clearError();
  fetch(apiUrl)
    .then(response => response.json())
    .then(slots => {
      const slotsContainer = document.getElementById('timeslots');
      const slotSelect = document.getElementById('slotSelect');
      const deleteSlotSelect = document.getElementById('deleteSlotSelect');
      slotsContainer.innerHTML = '';
      slotSelect.innerHTML = '<option value="">Select a Time Slot</option>';
      deleteSlotSelect.innerHTML = '<option value="">Select a Time Slot to Delete</option>';

      slots.forEach(slot => {
        const slotDiv = document.createElement('div');
        slotDiv.className = 'timeslot available';
        slotDiv.innerHTML = `Date: ${slot.SlotDate}, Time: ${slot.SlotTime}`;
        slotsContainer.appendChild(slotDiv);

        const option = document.createElement('option');
        option.value = slot.SlotID;
        option.textContent = `Date: ${slot.SlotDate}, Time: ${slot.SlotTime}`;
        slotSelect.appendChild(option);
        deleteSlotSelect.appendChild(option.cloneNode(true));
      });
    })
    .catch(error => {
      displayError('Failed to fetch slots: ' + error.message);
    });
}

function createSlot() {
  clearError();
  const slotDate = document.getElementById('newSlotDate').value;
  const slotTime = document.getElementById('newSlotTime').value;

  fetch(apiUrl, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      slot_date: slotDate,
      slot_time: slotTime
    })
  })
  .then(response => response.json())
  .then(data => {
    if (data.status === 'success') {
      fetchSlots(); // Refresh the list of available slots
    } else {
      displayError(data.detail);
    }
  })
  .catch(error => {
    displayError('Failed to create slot: ' + error.message);
  });
}

function bookSlot() {
  clearError();
  const firstName = document.getElementById('firstName').value;
  const lastName = document.getElementById('lastName').value;
  const slotId = document.getElementById('slotSelect').value;

  if (!firstName || !lastName || !slotId) {
    displayError('Please fill in all fields.');
    return;
  }

  fetch(apiUrl, {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      slot_id: parseInt(slotId, 10),
      customer_first_name: firstName,
      customer_last_name: lastName
    })
  })
  .then(response => response.json())
  .then(data => {
    if (data.status === 'success') {
      fetchSlots(); // Refresh the list of available slots
    } else {
      displayError(data.detail);
    }
  })
  .catch(error => {
    displayError('Failed to book slot: ' + error.message);
  });
}

function deleteSlot() {
  clearError();
  const slotId = document.getElementById('deleteSlotSelect').value;

  if (!slotId) {
    displayError('Please select a slot to delete.');
    return;
  }

  fetch(apiUrl, {
    method: 'DELETE',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      slot_id: parseInt(slotId, 10)
    })
  })
  .then(response => response.json())
  .then(data => {
    if (data.status === 'success') {
      fetchSlots(); // Refresh the list of available slots
    } else {
      displayError(data.detail);
    }
  })
  .catch(error => {
    displayError('Failed to delete slot: ' + error.message);
  });
}

// Initial fetch of available slots
fetchSlots();
</script>
</body>
</html>